# 🚀 Coding Challenge — Modular Chatbot with Router, Agents, Security, and Observability

## 📑 Table of Contents
1. [🎯 Objective](#1-objective)
2. [🧠 Architecture](#2-architecture)  
   2.1. [🔀 RouterAgent](#21-routeragent)  
   2.2. [📚 KnowledgeAgent](#22-knowledgeagent)  
   2.3. [🧮 MathAgent](#23-mathagent)  
3. [📡 API](#3-api)  
4. [💻 Front-End (React)](#4-front-end-react)  
5. [🔐 Security Requirements](#5-security-requirements)  
6. [📊 Observability Requirements](#6-observability-requirements)  
7. [⚙️ Infrastructure](#7-infrastructure)  
8. [🧪 Tests](#8-tests)  
9. [💬 Example Messages](#9-example-messages)  
10. [📄 Expected README.md](#10-expected-readmemd)  
11. [🏆 Bonus Challenge (Optional)](#11-bonus-challenge-optional)  

---

## 1. 🎯 Objective
Build a modular, simple application that demonstrates software engineering best practices, including:

- Agent routing
- Basic security
- Observability with structured logs
- Automated tests
- Modern infrastructure with Redis, Docker, and Kubernetes

---

## 2. 🧠 Architecture

### 2.1. 🔀 RouterAgent
- Receives user messages.
- Decides which agent should answer: **KnowledgeAgent** or **MathAgent**.
- Generates structured logs with decision details.

### 2.2. 📚 KnowledgeAgent
- Uses **RAG (Retrieval-Augmented Generation)** based on content from:
  - [https://ajuda.infinitepay.io/pt-BR/](https://ajuda.infinitepay.io/pt-BR/)
- May use **LangChain**, **LlamaIndex**, or similar.
- Must log:
  - Source of the answer
  - Execution time

### 2.3. 🧮 MathAgent
- Uses an LLM to interpret and answer simple mathematical expressions.
- Examples:
  - `"How much is 65 x 3.11?"`
  - `"70 + 12"`
  - `"(42 * 2) / 6"`

---

## 3. 📡 API

**Endpoint:**
```
POST /chat
```

**Payload:**
```json
{
  "message": "Qual a taxa da maquininha?",
  "user_id": "client789",
  "conversation_id": "conv-1234"
}
```

**Expected Response:**
```json
{
  "response": "Here is the answer with personality.",
  "source_agent_response": "Text generated by the specialized agent.",
  "agent_workflow": [
    { "agent": "RouterAgent", "decision": "KnowledgeAgent" },
    { "agent": "KnowledgeAgent" }
  ]
}
```

---

## 4. 💻 Front-End (React)

**Requirements:**
- Simple chat interface.
- Support multiple conversations via `conversation_id`.
- Display:
  - Full conversation history
  - Agent responsible for each response

---

## 5. 🔐 Security Requirements

### Input Sanitization
- Remove malicious content (e.g., HTML, JS).

### Prompt Injection Prevention
- Minimal defense mechanism in prompts, such as language validation or blocking suspicious instructions.

### Error Handling
- Never return raw exceptions to the client.

---

## 6. 📊 Observability Requirements

Structured logs must include:
- `timestamp`
- `level`: INFO, DEBUG, ERROR
- `agent`: Router, Knowledge, or Math
- `conversation_id`
- `user_id`
- `execution_time`
- `decision` or processed content

**Example:**
```json
{
  "timestamp": "2025-08-07T14:32:12Z",
  "level": "INFO",
  "agent": "RouterAgent",
  "conversation_id": "conv-1234",
  "user_id": "client789",
  "decision": "KnowledgeAgent"
}
```

> ⚠️ Grafana or Prometheus are **not required**.

---

## 7. ⚙️ Infrastructure

### Redis (required)
Can be used for:
- Storing conversation history
- Simplified logging

### Docker
- **Dockerfile** for front-end and back-end.
- **docker-compose.yml** for local execution.

### Kubernetes
Organized YAMLs for:
- Deployment, Service, Ingress of:
  - Front-end
  - Back-end
  - Redis

---

## 8. 🧪 Tests

Basic unit tests:
- RouterAgent decision
- Simple expressions in MathAgent
- E2E for the `/chat` API

---

## 9. 💬 Example Messages

- `"What are the card machine fees?"`
- `"Can I use my phone as a card machine?"`
- `"How much is 65 x 3.11?"`

---

## 10. 📄 Expected `README.md`

The file must include:
1. How to run the system locally (**Docker + docker-compose**)
2. How to run on Kubernetes (`kubectl apply -f`)
3. Architecture description (**Router, Agents, Logs, Redis**)
4. How to access the front-end and test multiple conversations
5. Example logs (in JSON)
6. How sanitization and prompt injection protection work
7. How to run the tests

---

## 11. 🏆 Bonus Challenge (Optional)

### 💡 Push yourself beyond local
Deploy the project on some cloud platform (free or trial).

**Examples:**
- Render.com
- Railway
- Fly.io
- Google Cloud Run
- Vercel (front-end)
- etc.

**Include in the README:**
- Public URL
- Brief explanation of how you deployed it